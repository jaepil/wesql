--source suite/smartengine/include/have_smartengine.inc

let $ddir = $MYSQL_TMP_DIR/.smartengine_datadir.test.install.db;
let $rdb_ddir = $MYSQL_TMP_DIR/.smartengine_datadir.test;
let $sql_file = $MYSQL_TMP_DIR/smartengine_datadir.sql;
let $repo_id = "objectstore_smartengine_datadir_not_exists";

--write_file $sql_file
DROP DATABASE IF EXISTS mysqltest;
CREATE DATABASE mysqltest;
USE mysqltest;
CREATE TABLE t1 (a INT PRIMARY KEY);
INSERT INTO t1 VALUES(42);
SET GLOBAL smartengine_flush_memtable = 1;
SELECT sleep(1);
DROP TABLE t1;
EOF

# Must ensure this directory exists before launching mysqld
mkdir $ddir;

# Launch mysqld with non-standard smartengine_datadir
exec $MYSQLD_BOOTSTRAP_CMD --repo_objectstore_id=$repo_id --datadir=$ddir --smartengine_data_dir=$rdb_ddir --default-storage-engine=SMARTENGINE --default-tmp-storage-engine=MyISAM --smartengine < $sql_file;

#not used MANIFEST
--echo Check for the number of MANIFEST files
--exec ls $rdb_ddir/*.manifest | wc -l;

# Clean up
exec rm -rf $ddir;
exec rm -rf $rdb_ddir;
remove_file $sql_file;
--source suite/smartengine/include/check_smartengine_log_error.inc
